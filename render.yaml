services:
- type: web
  name: radiology-api-staging
  env: python
  plan: free
  repo: https://github.com/twocolddogs/HNZpriority.git
  branch: develop
  rootDir: ./radiology-cleaner-app/backend
  buildFilter:
    paths:
      - "radiology-cleaner-app/backend/**"
  envVars:
    - key: PYTHON_VERSION
      value: 3.11.6
    - key: PIP_VERSION
      value: 23.2.1
    - key: PIP_CACHE_DIR
      value: /opt/render/.cache/pip
  buildCommand: "chmod +x build.sh && ./build.sh"
 
  startCommand: "gunicorn --bind 0.0.0.0:$PORT --workers 1 --timeout 180 --preload --log-level debug 'radiology-cleaner-app.backend.app:app'"
  autoDeploy: true
  healthCheckPath: /health

- type: web
  name: radiology-api-prod
  env: python
  plan: free
  repo: https://github.com/twocolddogs/HNZpriority.git
  branch: main
  rootDir: ./radiology-cleaner-app/backend
  buildFilter:
    paths:
      - "radiology-cleaner-app/backend/**"
  envVars:
    - key: PYTHON_VERSION
      value: 3.11.6
    - key: PIP_VERSION
      value: 23.2.1
    - key: PIP_CACHE_DIR
      value: /opt/render/.cache/pip
  buildCommand: "chmod +x build.sh && ./build.sh"
 
  startCommand: "gunicorn --bind 0.0.0.0:$PORT --workers 1 --timeout 180 --preload --log-level info 'radiology-cleaner-app.backend.app:app'"
  autoDeploy: false
  healthCheckPath: /health

- type: static
  name: radiology-cleaner-frontend-staging
  repo: https://github.com/twocolddogs/HNZpriority.git
  branch: develop
  rootDir: ./radiology-cleaner-app/frontend
  buildFilter:
    paths:
      - "radiology-cleaner-app/frontend/**"
  buildCommand: echo "Static files - no build needed"
  staticPublishPath: ./
  pullRequestPreviewsEnabled: true
  routes:
    - type: rewrite
      source: /api/(.*)
      destination: https://radiology-api-staging.onrender.com/$1
    - type: rewrite
      source: /*
      destination: /index.html

- type: static
  name: radiology-cleaner-frontend-prod
  repo: https://github.com/twocolddogs/HNZpriority.git
  branch: main
  rootDir: ./radiology-cleaner-app/frontend
  buildFilter:
    paths:
      - "radiology-cleaner-app/frontend/**"
  buildCommand: echo "Static files - no build needed"
  staticPublishPath: ./
  routes:
    - type: rewrite
      source: /api/(.*)
      destination: https://radiology-api-prod.onrender.com/$1
    - type: rewrite
      source: /*
      destination: /index.html