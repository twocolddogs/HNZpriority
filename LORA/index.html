<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Scenario Baseline Viewer</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    h2, h3, h4 { margin-top: 30px; }
    .modality { margin-bottom: 40px; border: 1px solid #ccc; padding: 10px; border-radius: 6px; background: #fdfdfd; }
    .archetype { margin: 15px 0; border: 1px solid #bbb; border-radius: 5px; overflow: hidden; }
    .archetype-header { background: #eee; padding: 10px; cursor: pointer; font-weight: bold; }
    .archetype-content { display: none; padding: 10px; background: #fff; }
    table { border-collapse: collapse; margin-top: 10px; width: 100%; font-size: 0.9em; }
    th, td { border: 1px solid #ccc; padding: 4px 6px; text-align: center; }
    th { background-color: #f9f9f9; }
    .section-label { font-weight: bold; margin-top: 20px; margin-bottom: 5px; font-size: 1em; }
    .metric-label { text-align: left; font-weight: bold; background: #fcfcfc; }
  </style>
</head>
<body>

<h2>Baseline Scenario Viewer</h2>
<p>Select the <strong>input_configuration.xlsx</strong> file:</p>
<input type="file" id="fileInput" accept=".xlsx" />

<div id="output"></div>

<script>
document.getElementById('fileInput').addEventListener('change', function(event) {
  const reader = new FileReader();
  reader.onload = function(e) {
    const data = new Uint8Array(e.target.result);
    const workbook = XLSX.read(data, { type: 'array' });
    const sheet = workbook.Sheets[workbook.SheetNames[0]];
    const json = XLSX.utils.sheet_to_json(sheet);
    const baseline = json.slice(1, 21); // rows 2–21
    renderGroupedView(baseline);
  };
  reader.readAsArrayBuffer(event.target.files[0]);
});

function renderGroupedView(data) {
  const container = document.getElementById('output');
  container.innerHTML = '';

  const grouped = {};
  for (const row of data) {
    const modality = row['Modality'] || 'UNKNOWN';
    const archetype = row['Archetype'] || 'UNKNOWN';
    if (!grouped[modality]) grouped[modality] = {};
    grouped[modality][archetype] = row;
  }

  for (const [modality, archetypes] of Object.entries(grouped)) {
    const modDiv = document.createElement('div');
    modDiv.className = 'modality';
    modDiv.innerHTML = `<h3>${modality}</h3>`;

    for (const [arch, row] of Object.entries(archetypes)) {
      const archDiv = document.createElement('div');
      archDiv.className = 'archetype';

      const header = document.createElement('div');
      header.className = 'archetype-header';
      header.textContent = `Archetype: ${arch}`;
      header.addEventListener('click', () => {
        content.style.display = content.style.display === 'none' ? 'block' : 'none';
      });

      const content = document.createElement('div');
      content.className = 'archetype-content';

      // ===== Baseline y0 table =====
      const y0Table = document.createElement('table');
      const y0Header = document.createElement('tr');
      y0Header.innerHTML = '<th>Metric</th><th>y0 Value</th>';
      y0Table.appendChild(y0Header);

      const y0Fields = [
        ['IP volume y0', row['IP volume step y0']],
        ['OP volume y0', row['OP volume step y0']],
        ['Scan rate y0', row['Scan rate y0']],
        ['Report rate y0', row['Report rate y0']],
        ['MITs/hour y0', row['MITs per routine machine hour y0']],
        ['MITs/hour y0.1', row['MITs per routine machine hour y0.1']],
        ['Routine machine hours', row['Routine machine hours']],
        ['MITs per machine hours', row['MITs per machine hours']],
        ['Scenario', row['Scenario']],
        ['Baseyear', row['Baseyear']]
      ];

      for (const [label, value] of y0Fields) {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td class="metric-label">${label}</td><td>${value ?? ''}</td>`;
        y0Table.appendChild(tr);
      }

      const baselineLabel = document.createElement('div');
      baselineLabel.className = 'section-label';
      baselineLabel.textContent = 'Baseline (y0)';
      content.appendChild(baselineLabel);
      content.appendChild(y0Table);

      // ===== Projections y1–y10 table =====
      const projLabel = document.createElement('div');
      projLabel.className = 'section-label';
      projLabel.textContent = 'Projections (y1 to y10)';

      const projTable = document.createElement('table');
      const projHeader = document.createElement('tr');
      projHeader.innerHTML = '<th>Metric</th>' +
        [...Array(10)].map((_, i) => `<th>y${i + 1}</th>`).join('');
      projTable.appendChild(projHeader);

      const metrics = [
        { label: 'IP Volume', prefix: 'IP volume step y' },
        { label: 'OP Volume', prefix: 'OP volume step y' },
        { label: 'Scan Rate', prefix: 'Scan rate y' },
        { label: 'Report Rate', prefix: 'Report rate y' },
        { label: 'MITs/hr', prefix: 'MITs per routine machine hour y' }
      ];

      for (const metric of metrics) {
        const rowEl = document.createElement('tr');
        rowEl.innerHTML = `<td class="metric-label">${metric.label}</td>` +
          [...Array(10)].map((_, i) => `<td>${row[`${metric.prefix}${i + 1}`] ?? ''}</td>`).join('');
        projTable.appendChild(rowEl);
      }

      content.appendChild(projLabel);
      content.appendChild(projTable);
      archDiv.appendChild(header);
      archDiv.appendChild(content);
      modDiv.appendChild(archDiv);
    }

    container.appendChild(modDiv);
  }
}
</script>

</body>
</html>