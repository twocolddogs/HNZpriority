<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Scenario Baseline Viewer</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    h2, h3, h4 { margin-top: 30px; }
    .modality { margin-bottom: 40px; border: 1px solid #ccc; padding: 10px; border-radius: 6px; background: #fdfdfd; }
    .archetype { margin: 15px 0; border: 1px solid #bbb; border-radius: 5px; overflow: hidden; }
    .archetype-header { background: #eee; padding: 10px; cursor: pointer; font-weight: bold; }
    .archetype-content { display: none; padding: 10px; background: #fff; }
    table { border-collapse: collapse; margin-top: 10px; width: 100%; font-size: 0.9em; }
    th, td { border: 1px solid #ccc; padding: 4px 6px; text-align: center; }
    th { background-color: #f9f9f9; }
    .metadata { margin-bottom: 10px; }
    .metadata span { margin-right: 15px; display: inline-block; font-size: 0.9em; }
    .metric-label { text-align: left; font-weight: bold; background: #fcfcfc; }
  </style>
</head>
<body>

<h2>Baseline Scenario Viewer</h2>
<p>Select the input_configuration Excel file to view:</p>
<input type="file" id="fileInput" accept=".xlsx" />

<div id="output"></div>

<script>
document.getElementById('fileInput').addEventListener('change', function(event) {
  const reader = new FileReader();
  reader.onload = function(e) {
    const data = new Uint8Array(e.target.result);
    const workbook = XLSX.read(data, { type: 'array' });
    const sheet = workbook.Sheets[workbook.SheetNames[0]];
    const json = XLSX.utils.sheet_to_json(sheet);
    const baseline = json.slice(1, 21); // Excel rows 2â€“21
    renderGroupedView(baseline);
  };
  reader.readAsArrayBuffer(event.target.files[0]);
});

function renderGroupedView(data) {
  const container = document.getElementById('output');
  container.innerHTML = '';

  const grouped = {};
  for (const row of data) {
    const modality = row['Modality'] || 'UNKNOWN';
    const archetype = row['Archetype'] || 'UNKNOWN';
    if (!grouped[modality]) grouped[modality] = {};
    grouped[modality][archetype] = row;
  }

  for (const [modality, archetypes] of Object.entries(grouped)) {
    const modDiv = document.createElement('div');
    modDiv.className = 'modality';
    modDiv.innerHTML = `<h3>${modality}</h3>`;

    for (const [arch, row] of Object.entries(archetypes)) {
      const archDiv = document.createElement('div');
      archDiv.className = 'archetype';

      const header = document.createElement('div');
      header.className = 'archetype-header';
      header.textContent = `Archetype: ${arch}`;
      header.addEventListener('click', () => {
        content.style.display = content.style.display === 'none' ? 'block' : 'none';
      });

      const content = document.createElement('div');
      content.className = 'archetype-content';

      // Metadata
      const metadata = document.createElement('div');
      metadata.className = 'metadata';
      const metaFields = ['Scenario', 'Baseyear', 'Routine machine hours', 'MITs per machine hours'];
      metaFields.forEach(key => {
        if (row[key] !== undefined) {
          const span = document.createElement('span');
          span.textContent = `${key}: ${row[key]}`;
          metadata.appendChild(span);
        }
      });

      // Metric matrix (years y0 to y10)
      const table = document.createElement('table');
      const headerRow = document.createElement('tr');
      headerRow.innerHTML = `<th></th>${[...Array(11)].map((_, i) => `<th>y${i}</th>`).join('')}`;
      table.appendChild(headerRow);

      const metrics = [
        { label: 'IP Volume', prefix: 'IP volume step y' },
        { label: 'OP Volume', prefix: 'OP volume step y' },
        { label: 'Scan Rate', prefix: 'Scan rate y' },
        { label: 'Report Rate', prefix: 'Report rate y' },
        { label: 'MITs/hr', prefix: 'MITs per routine machine hour y' }
      ];

      for (const metric of metrics) {
        const rowEl = document.createElement('tr');
        rowEl.innerHTML = `<td class="metric-label">${metric.label}</td>` +
          [...Array(11)].map((_, i) => `<td>${row[`${metric.prefix}${i}`] ?? ''}</td>`).join('');
        table.appendChild(rowEl);
      }

      content.appendChild(metadata);
      content.appendChild(table);
      archDiv.appendChild(header);
      archDiv.appendChild(content);
      modDiv.appendChild(archDiv);
    }

    container.appendChild(modDiv);
  }
}
</script>

</body>
</html>