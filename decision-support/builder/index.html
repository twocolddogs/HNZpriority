<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HNZ Decision Tree Builder</title>
    <link rel="stylesheet" href="../styles.css">
</head>
<body>
    <div class="app-container">
        <div class="header">
            <div class="brand-bar">
                <img src="../../images/HealthNZ_logo_v2.svg" alt="Health New Zealand Logo" class="app-logo">
                <div class="header-divider"></div>
                <h1 class="title">Decision Tree Builder</h1>
                
                <!-- Hamburger Menu -->
                <div class="hamburger-menu">
                    <button id="hamburgerToggle" class="hamburger-button">
                        <span class="hamburger-line"></span>
                        <span class="hamburger-line"></span>
                        <span class="hamburger-line"></span>
                    </button>
                    
                    <div id="hamburgerDropdown" class="hamburger-dropdown hidden">
                        <div class="dropdown-section">
                            <button id="menuSaveDraft" class="dropdown-item">
                                <span class="dropdown-icon nerd-icon">󰆓</span>
                                Save Draft
                            </button>
                            <button id="menuPublish" class="dropdown-item">
                                <span class="dropdown-icon nerd-icon">󰅟</span>
                                Publish
                            </button>
                        </div>
                        
                        <div class="dropdown-divider"></div>
                        
                        <div class="dropdown-section">
                            <a href="../index.html" id="menuLiveApp" class="dropdown-item">
                                <span class="dropdown-icon nerd-icon">󰖟</span>
                                View Live App
                            </a>
                        </div>
                        
                        <div class="dropdown-divider"></div>
                        
                        <div class="dropdown-section">
                            <button id="menuHelp" class="dropdown-item">
                                <span class="dropdown-icon nerd-icon">󰋖</span>
                                Help
                            </button>
                        </div>
                        
                        <div class="dropdown-divider"></div>
                        
                        <div class="dropdown-section">
                            <button id="menuAdvanced" class="dropdown-item toggle-item">
                                <span class="dropdown-icon nerd-icon">󰓔</span>
                                <span>Advanced</span>
                                <span id="advancedToggle" class="toggle-indicator">OFF</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="main-content">
            <!-- Navigation Tabs -->
            <div class="nav-tabs">
                <button id="libraryTab" class="nav-tab active">Library</button>
                <button id="builderTab" class="nav-tab">Builder</button>
                <button id="previewTab" class="nav-tab">Preview</button>
                <button id="birdseyeTab" class="nav-tab">Birdseye</button>
                <button id="jsonTab" class="nav-tab hidden">JSON</button>
            </div>

            <!-- Library View -->
            <div id="libraryView" class="view active">
                <div class="library-layout">
                    <div class="library-header">
                        <h2>Pathway Library</h2>
                        <div class="library-actions">
                            <button id="newPathway" class="btn primary">New Pathway</button>
                        </div>
                    </div>
                    
                    <div class="library-filters">
                        <div class="filter-group">
                            <label for="statusFilter">Status:</label>
                            <select id="statusFilter">
                                <option value="all">All</option>
                                <option value="draft">Draft</option>
                                <option value="published">Published</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <input type="text" id="searchFilter" placeholder="Search pathways...">
                        </div>
                    </div>
                    
                    <div id="pathwaysList" class="pathways-list">
                        <div id="pathwaysLoading" class="pathways-loading">
                            <div class="loading-spinner"></div>
                            <p>Loading pathways...</p>
                        </div>
                        <!-- Pathways will be listed here -->
                    </div>
                </div>
            </div>

            <!-- Builder View -->
            <div id="builderView" class="view">
                <div class="builder-layout">
                    <!-- Tree Properties Panel -->
                    <div class="properties-panel">
                        <h3>Pathway Properties</h3>
                        <div class="form-group">
                            <label for="treeId">Pathway ID</label>
                            <input type="text" id="treeId" placeholder="unique-pathway-id">
                        </div>
                        <div class="form-group">
                            <label for="treeTitle">Title</label>
                            <input type="text" id="treeTitle" placeholder="Decision Pathway Title">
                        </div>
                        <div class="form-group">
                            <label for="treeDescription">Description</label>
                            <textarea id="treeDescription" placeholder="Optional description"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="startStep">Start Step</label>
                            <select id="startStep">
                                <option value="">Select start step...</option>
                            </select>
                        </div>

                        <h4>Guides</h4>
                        <div id="guidesList" class="guides-list">
                            <!-- Guides will be listed here -->
                        </div>
                        <button id="addGuide" class="btn secondary">Add Guide</button>
                    </div>

                    <!-- Steps Editor -->
                    <div class="steps-panel">
                        <div class="steps-header">
                            <h3>Decision Steps</h3>
                            <button id="addStep" class="btn primary">Add Step</button>
                        </div>
                        <div id="stepsList" class="steps-list">
                            <!-- Steps will be listed here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Birdseye View -->
            <div id="birdseyeView" class="view">
                <div id="flowchartContainer" class="flowchart-container">
                    <svg id="flowchartSvg" class="flowchart-svg">
                        <!-- Flowchart will be rendered here -->
                    </svg>
                </div>
            </div>

            <!-- Preview View -->
            <div id="previewView" class="view">
                <div id="previewContent" class="preview-content">
                    <!-- Preview will be rendered here -->
                </div>
            </div>

            <!-- JSON View -->
            <div id="jsonView" class="view">
                <div class="json-editor">
                    <textarea id="jsonOutput" readonly></textarea>
                </div>
                <input type="file" id="jsonFileInput" accept=".json" style="display: none;">
            </div>

            <!-- Help View -->
            <div id="helpView" class="view help-view">
                <div class="help-content">
                    <div class="help-header">
                        <h1>Decision Tree Builder Help</h1>
                        <p class="help-subtitle">Complete guide to building clinical decision support pathways</p>
                    </div>

                    <div class="help-sections">
                        <!-- Getting Started -->
                        <section class="help-section">
                            <h2>🚀 Getting Started</h2>
                            <div class="help-card">
                                <h3>1. Create a New Pathway</h3>
                                <p>Click <strong>"New Pathway"</strong> in the Library tab to create a new decision tree. This initializes a pathway with a default title that you can customize.</p>
                                
                                <h3>2. Set Pathway Properties</h3>
                                <p>In the Builder tab, configure:</p>
                                <ul>
                                    <li><strong>Title:</strong> Main pathway name (e.g., "Liver Imaging Decision Tool")</li>
                                    <li><strong>Subtitle:</strong> Brief description or version info</li>
                                    <li><strong>Description:</strong> Detailed explanation of the pathway's purpose</li>
                                </ul>
                                
                                <h3>3. Add Your First Step</h3>
                                <p>Click <strong>"Add Step"</strong> to create your first decision point. The first step automatically becomes the starting point of your pathway.</p>
                            </div>
                        </section>

                        <!-- Step Types -->
                        <section class="help-section">
                            <h2>📋 Step Types</h2>
                            <div class="help-card">
                                <div class="step-type-grid">
                                    <div class="step-type-item">
                                        <h4>Multiple Choice</h4>
                                        <p>Present several options to the user. Best for scenarios with 3+ possible paths.</p>
                                        <div class="example">Example: "Patient age group?" → Under 18, 18-65, Over 65</div>
                                    </div>
                                    
                                    <div class="step-type-item">
                                        <h4>Yes/No Decision</h4>
                                        <p>Simple binary choice. Ideal for clinical criteria or symptoms.</p>
                                        <div class="example">Example: "Patient has fever?" → Yes, No</div>
                                    </div>
                                    
                                    <div class="step-type-item">
                                        <h4>Endpoint (Recommendation)</h4>
                                        <p>Final step that provides clinical recommendation. No further navigation.</p>
                                        <div class="example">Example: "Recommend specialist consultation" or "Perform CT chest with contrast"</div>
                                    </div>
                                    
                                    <div class="step-type-item">
                                        <h4>Guide</h4>
                                        <p>Informational step with additional details. Can continue to other steps.</p>
                                        <div class="example">Example: Additional guidance for specific clinical procedures</div>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- Building Steps -->
                        <section class="help-section">
                            <h2>🔧 Building Steps</h2>
                            <div class="help-card">
                                <h3>Step Configuration</h3>
                                <p>When creating or editing a step:</p>
                                <ol>
                                    <li><strong>Step Type:</strong> Choose the appropriate type first (auto-prioritized)</li>
                                    <li><strong>Title:</strong> Clear, concise question or statement</li>
                                    <li><strong>Subtitle:</strong> Optional additional context</li>
                                    <li><strong>Description:</strong> Detailed instructions or information</li>
                                    <li><strong>Step ID:</strong> Technical identifier (auto-generated, editable)</li>
                                </ol>

                                <h3>Adding Options</h3>
                                <p>For Choice and Yes/No steps:</p>
                                <ul>
                                    <li><strong>Option Text:</strong> What users will see and click</li>
                                    <li><strong>Variant:</strong> Button style (primary, secondary, success, warning, etc.)</li>
                                    <li><strong>Action:</strong> Where this option leads (navigate to step or recommend imaging)</li>
                                </ul>

                                <h3>Callouts and Formatting</h3>
                                <p>Use callouts in descriptions to highlight important information:</p>
                                <ul>
                                    <li><code>[info]Important note[/info]</code> - Blue information box</li>
                                    <li><code>[warning]Be careful[/warning]</code> - Yellow warning box</li>
                                    <li><code>[protocol]Clinical guidance[/protocol]</code> - Green guidance box</li>
                                    <li><code>[success]Good practice[/success]</code> - Green success box</li>
                                    <li><code>[danger]Critical warning[/danger]</code> - Red danger box</li>
                                </ul>
                            </div>
                        </section>

                        <!-- Navigation and Flow -->
                        <section class="help-section">
                            <h2>🔄 Navigation and Flow</h2>
                            <div class="help-card">
                                <h3>Creating Pathways</h3>
                                <p>Options can lead to:</p>
                                <ul>
                                    <li><strong>Existing Step:</strong> Continue to another decision point</li>
                                    <li><strong>New Step:</strong> Create and navigate to a new step</li>
                                    <li><strong>Recommendation:</strong> End with clinical recommendation</li>
                                </ul>

                                <h3>Best Practices</h3>
                                <ul>
                                    <li>Keep step titles concise and clear</li>
                                    <li>Use descriptive option text that clearly indicates the choice</li>
                                    <li>Organize complex pathways with logical flow</li>
                                    <li>Test your pathway flow using the Preview tab</li>
                                    <li>Use the Birdseye view to visualize the overall structure</li>
                                </ul>
                            </div>
                        </section>

                        <!-- Guides -->
                        <section class="help-section">
                            <h2>📚 Guides and Additional Information</h2>
                            <div class="help-card">
                                <h3>Creating Guides</h3>
                                <p>Guides provide additional information and clinical context:</p>
                                <ul>
                                    <li><strong>Guide Title:</strong> Name of the guidance or procedure</li>
                                    <li><strong>Sections:</strong> Organized content blocks with titles and descriptions</li>
                                    <li><strong>Lists:</strong> Bullet points for step-by-step instructions</li>
                                </ul>

                                <h3>Guide Sections</h3>
                                <p>Each guide can contain multiple sections:</p>
                                <ul>
                                    <li><strong>Text:</strong> Paragraph content</li>
                                    <li><strong>List:</strong> Bulleted or numbered items</li>
                                </ul>
                            </div>
                        </section>

                        <!-- Testing and Preview -->
                        <section class="help-section">
                            <h2>🔍 Testing Your Pathway</h2>
                            <div class="help-card">
                                <h3>Preview Tab</h3>
                                <p>Use the Preview tab to test your pathway as users will experience it:</p>
                                <ul>
                                    <li>Automatically updates when you make changes</li>
                                    <li>Test all decision paths and options</li>
                                    <li>Verify that recommendations appear correctly</li>
                                    <li>Check that guides display properly</li>
                                </ul>

                                <h3>Birdseye View</h3>
                                <p>Visualize your pathway structure:</p>
                                <ul>
                                    <li>See all steps and their connections</li>
                                    <li>Identify potential dead ends or missing connections</li>
                                    <li>Use "Auto Layout" to organize the diagram</li>
                                    <li>Different colors indicate different step types</li>
                                </ul>

                                <h3>Testing Checklist</h3>
                                <ul>
                                    <li>✓ All decision paths lead to appropriate endpoints</li>
                                    <li>✓ No broken links or missing steps</li>
                                    <li>✓ Recommendations include required clinical details</li>
                                    <li>✓ Guides are accessible and informative</li>
                                    <li>✓ Step titles and options are clear and clinically appropriate</li>
                                </ul>
                            </div>
                        </section>

                        <!-- Publishing -->
                        <section class="help-section">
                            <h2>🚀 Publishing Your Pathway</h2>
                            <div class="help-card">
                                <h3>Before Publishing</h3>
                                <ul>
                                    <li>Complete testing in Preview tab</li>
                                    <li>Verify all pathways lead to appropriate recommendations</li>
                                    <li>Check clinical accuracy and completeness</li>
                                    <li>Ensure guides contain necessary clinical information</li>
                                </ul>

                                <h3>Publishing Process</h3>
                                <ol>
                                    <li>Click the hamburger menu (☰)</li>
                                    <li>Select <strong>"Publish"</strong></li>
                                    <li>Confirm pathway validation</li>
                                    <li>The pathway becomes available in the main application</li>
                                    <li>Library automatically refreshes to show published pathway</li>
                                </ol>

                                <h3>Post-Publishing</h3>
                                <ul>
                                    <li>Published pathways appear in the Live App</li>
                                    <li>Users can access them through the main decision support interface</li>
                                    <li>Monitor usage and gather feedback for improvements</li>
                                </ul>
                            </div>
                        </section>

                        <!-- Troubleshooting -->
                        <section class="help-section">
                            <h2>⚠️ Troubleshooting</h2>
                            <div class="help-card">
                                <h3>Common Issues</h3>
                                
                                <h4>Preview Not Showing Steps</h4>
                                <ul>
                                    <li>Ensure your pathway has a title</li>
                                    <li>Check that a start step is selected</li>
                                    <li>Verify steps have been saved properly</li>
                                </ul>

                                <h4>Cannot Publish</h4>
                                <ul>
                                    <li>All steps must have titles</li>
                                    <li>All steps must have a valid type</li>
                                    <li>Choice/Yes-No steps must have at least one option</li>
                                    <li>Endpoint steps must have recommendation details</li>
                                </ul>

                                <h4>Broken Navigation</h4>
                                <ul>
                                    <li>Check that option actions point to valid steps</li>
                                    <li>Ensure recommendation endpoints are properly configured</li>
                                    <li>Use Birdseye view to identify connection issues</li>
                                </ul>

                                <h3>Validation Requirements</h3>
                                <p>Your pathway must meet these requirements to publish:</p>
                                <ul>
                                    <li>✓ Pathway has a title</li>
                                    <li>✓ At least one step exists</li>
                                    <li>✓ Start step is specified</li>
                                    <li>✓ All steps have titles and types</li>
                                    <li>✓ All options have valid actions</li>
                                    <li>✓ All recommendation endpoints are complete</li>
                                </ul>
                            </div>
                        </section>

                        <!-- Tips and Best Practices -->
                        <section class="help-section">
                            <h2>💡 Tips and Best Practices</h2>
                            <div class="help-card">
                                <h3>Content Guidelines</h3>
                                <ul>
                                    <li>Use clear, clinical language appropriate for healthcare professionals</li>
                                    <li>Keep step titles concise (under 10 words when possible)</li>
                                    <li>Use option variants to indicate importance (primary for recommended actions)</li>
                                    <li>Include relevant clinical context in step descriptions</li>
                                    <li>Use callouts to highlight critical information</li>
                                </ul>

                                <h3>Structure Guidelines</h3>
                                <ul>
                                    <li>Start with broad categorization, then narrow down</li>
                                    <li>Group related decision points together</li>
                                    <li>Avoid overly deep decision trees (6+ levels)</li>
                                    <li>Provide clear exit points with appropriate recommendations</li>
                                    <li>Consider alternative pathways for edge cases</li>
                                </ul>

                                <h3>Workflow Tips</h3>
                                <ul>
                                    <li>Plan your pathway structure before building</li>
                                    <li>Build incrementally and test frequently</li>
                                    <li>Use the JSON view to backup your work</li>
                                    <li>Collaborate with clinical experts for content validation</li>
                                    <li>Document your pathway logic for future maintenance</li>
                                </ul>
                            </div>
                        </section>

                        <!-- Keyboard Shortcuts -->
                        <section class="help-section">
                            <h2>⌨️ Interface Guide</h2>
                            <div class="help-card">
                                <h3>Navigation Tabs</h3>
                                <ul>
                                    <li><strong>Library:</strong> View and manage existing pathways</li>
                                    <li><strong>Builder:</strong> Create and edit pathway structure</li>
                                    <li><strong>Preview:</strong> Test pathway functionality</li>
                                    <li><strong>Birdseye:</strong> Visualize pathway flow</li>
                                    <li><strong>JSON:</strong> View/edit raw pathway data (Advanced mode)</li>
                                </ul>

                                <h3>Hamburger Menu</h3>
                                <ul>
                                    <li><strong>Save:</strong> Download pathway file</li>
                                    <li><strong>Load:</strong> Import pathway from file</li>
                                    <li><strong>Publish:</strong> Make pathway live</li>
                                    <li><strong>View Live App:</strong> Open main decision support interface</li>
                                    <li><strong>Advanced:</strong> Toggle advanced features (JSON tab)</li>
                                </ul>

                                <h3>Quick Actions</h3>
                                <ul>
                                    <li>Click step cards in Birdseye to quickly edit them</li>
                                    <li>Use callout helper buttons in step descriptions</li>
                                    <li>Preview automatically updates after changes</li>
                                    <li>Library refreshes automatically after publishing</li>
                                </ul>
                            </div>
                        </section>
                    </div>

                    <div class="help-footer">
                        <p>Need additional help? Contact the system administrator or refer to your organization's clinical guidelines.</p>
                        <button id="closeHelp" class="btn primary">Close Help</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for editing steps -->
    <div id="stepModal" class="modal-overlay hidden">
        <div class="modal-container">
            <div class="modal-header">
                <h3 id="modalTitle">Edit Step</h3>
                <button id="closeModal" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="stepType">Step Type</label>
                    <select id="stepType">
                        <option value="choice">Multiple Choice</option>
                        <option value="yes-no">Yes/No Decision</option>
                        <option value="endpoint">Endpoint (Recommendation)</option>
                        <option value="guide">Guide</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="stepTitle">Title</label>
                    <input type="text" id="stepTitle" placeholder="Step Title">
                </div>
                <div class="form-group">
                    <label for="stepSubtitle">Subtitle (optional)</label>
                    <input type="text" id="stepSubtitle" placeholder="Optional subtitle">
                </div>
                <div class="form-group">
                    <label for="stepQuestion">Description</label>
                    <textarea id="stepQuestion" placeholder="Describe this step. You can use callouts like [info]Important note[/info] or [warning]Be careful[/warning]" rows="3"></textarea>
                    <div class="callout-helpers">
                        <small style="color: #6B7280; margin-bottom: 0.5rem; display: block;">Insert callouts:</small>
                        <button type="button" class="btn-callout" data-callout="protocol" title="Insert Protocol callout">Protocol</button>
                        <button type="button" class="btn-callout" data-callout="info" title="Insert Info callout">Info</button>
                        <button type="button" class="btn-callout" data-callout="warning" title="Insert Warning callout">Warning</button>
                        <button type="button" class="btn-callout" data-callout="success" title="Insert Success callout">Success</button>
                        <button type="button" class="btn-callout" data-callout="danger" title="Insert Danger callout">Danger</button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="stepId">Step ID</label>
                    <input type="text" id="stepId" placeholder="step-id">
                </div>

                <!-- Guide Info Section -->
                <div id="protocolSection" class="form-section hidden">
                    <h4>Guide Information</h4>
                    <div class="form-group">
                        <label for="protocolTitle">Guide Title</label>
                        <input type="text" id="protocolTitle" placeholder="Guide name">
                    </div>
                    <div class="form-group">
                        <label for="protocolDescription">Description</label>
                        <textarea id="protocolDescription" placeholder="Guide description"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="protocolNote">Note (optional)</label>
                        <input type="text" id="protocolNote" placeholder="Additional note">
                    </div>
                </div>

                <!-- Options Section -->
                <div id="optionsSection" class="form-section">
                    <h4>Options</h4>
                    <div id="optionsList" class="options-list">
                        <!-- Options will be listed here -->
                    </div>
                    <button id="addOption" class="btn secondary">Add Option</button>
                </div>

                <!-- Endpoint Section -->
                <div id="endpointSection" class="form-section hidden">
                    <h4>Recommendation</h4>
                    <div class="form-group">
                        <label for="endpointModality">Modality</label>
                        <input type="text" id="endpointModality" placeholder="MRI, CT, etc.">
                    </div>
                    <div class="form-group">
                        <label for="endpointContrast">Contrast</label>
                        <input type="text" id="endpointContrast" placeholder="Contrast details">
                    </div>
                    <div class="form-group">
                        <label for="endpointNotes">Notes (optional)</label>
                        <textarea id="endpointNotes" placeholder="Additional notes"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="endpointPriority">Priority (optional)</label>
                        <input type="text" id="endpointPriority" placeholder="P1, P2, etc.">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="saveStep" class="btn primary">Save Step</button>
                <button id="deleteStep" class="btn danger">Delete Step</button>
                <button id="cancelStep" class="btn secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Modal for editing options -->
    <div id="optionModal" class="modal-overlay hidden">
        <div class="modal-container">
            <div class="modal-header">
                <h3 id="optionModalTitle">Edit Option</h3>
                <button id="closeOptionModal" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="optionText">Option Text</label>
                    <input type="text" id="optionText" placeholder="Button text that users will see">
                </div>
                <div class="form-group">
                    <label for="optionVariant">Button Style</label>
                    <select id="optionVariant">
                        <option value="primary">Primary (Blue)</option>
                        <option value="secondary">Secondary (Gray)</option>
                        <option value="success">Success (Green)</option>
                        <option value="warning">Warning (Orange)</option>
                        <option value="danger">Danger (Red)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="optionAction">Action Type</label>
                    <select id="optionAction">
                        <option value="navigate">Navigate to Another Step</option>
                        <option value="recommend">Show Recommendation (End Step)</option>
                    </select>
                </div>

                <!-- Navigation Action Section -->
                <div id="navigationSection" class="form-section">
                    <h4>Navigation Target</h4>
                    <div class="form-group">
                        <label for="targetStep">Target Step</label>
                        <select id="targetStep">
                            <option value="">Select existing step...</option>
                            <option value="__NEW__">+ Create New Step</option>
                        </select>
                    </div>
                    <div id="newStepSection" class="form-subsection hidden">
                        <div class="form-group">
                            <label for="newStepId">New Step ID</label>
                            <input type="text" id="newStepId" placeholder="new-step-id">
                        </div>
                        <div class="form-group">
                            <label for="newStepTitle">New Step Title</label>
                            <input type="text" id="newStepTitle" placeholder="Step Title">
                        </div>
                        <div class="form-group">
                            <label for="newStepType">New Step Type</label>
                            <select id="newStepType">
                                <option value="choice">Multiple Choice</option>
                                <option value="yes-no">Yes/No Decision</option>
                                <option value="endpoint">Endpoint (Recommendation)</option>
                                <option value="guide">Guide</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Recommendation Action Section -->
                <div id="recommendationSection" class="form-section hidden">
                    <h4>Recommendation Details</h4>
                    <div class="form-group">
                        <label for="existingEndpoint">Use Existing Endpoint</label>
                        <select id="existingEndpoint">
                            <option value="">Create new recommendation...</option>
                            <option value="__NEW__">+ Create New Endpoint Step</option>
                        </select>
                    </div>
                    <div id="recommendationDetails" class="form-subsection">
                        <div class="form-group">
                            <label for="recModality">Modality</label>
                            <input type="text" id="recModality" placeholder="MRI, CT, Ultrasound, etc.">
                        </div>
                        <div class="form-group">
                            <label for="recContrast">Contrast</label>
                            <input type="text" id="recContrast" placeholder="Contrast details">
                        </div>
                        <div class="form-group">
                            <label for="recNotes">Notes (optional)</label>
                            <textarea id="recNotes" placeholder="Additional notes or instructions"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="recPriority">Priority (optional)</label>
                            <input type="text" id="recPriority" placeholder="P1, P2, S1, etc.">
                        </div>
                    </div>
                    <div id="newEndpointSection" class="form-subsection hidden">
                        <div class="form-group">
                            <label for="newEndpointId">New Endpoint Step ID</label>
                            <input type="text" id="newEndpointId" placeholder="endpoint-step-id">
                        </div>
                        <div class="form-group">
                            <label for="newEndpointTitle">New Endpoint Title</label>
                            <input type="text" id="newEndpointTitle" placeholder="Endpoint Step Title">
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="saveOption" class="btn primary">Save Option</button>
                <button id="deleteOption" class="btn danger">Delete Option</button>
                <button id="cancelOption" class="btn secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Modal for editing guides -->
    <div id="guideModal" class="modal-overlay hidden">
        <div class="modal-container">
            <div class="modal-header">
                <h3 id="guideModalTitle">Edit Guide</h3>
                <button id="closeGuideModal" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="guideTitle">Guide Title</label>
                    <input type="text" id="guideTitle" placeholder="Reference Guide">
                </div>

                <div class="form-section">
                    <h4>Guide Sections</h4>
                    <div id="guideSectionsList" class="options-list">
                        <!-- Guide sections will be listed here -->
                    </div>
                    <button id="addGuideSection" class="btn secondary">Add Section</button>
                </div>
            </div>
            <div class="modal-footer">
                <button id="saveGuide" class="btn primary">Save Guide</button>
                <button id="deleteGuide" class="btn danger">Delete Guide</button>
                <button id="cancelGuide" class="btn secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Modal for editing guide sections -->
    <div id="guideSectionModal" class="modal-overlay hidden">
        <div class="modal-container">
            <div class="modal-header">
                <h3 id="guideSectionModalTitle">Edit Section</h3>
                <button id="closeGuideSectionModal" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="sectionTitle">Section Title</label>
                    <input type="text" id="sectionTitle" placeholder="Section title">
                </div>
                <div class="form-group">
                    <label for="sectionType">Section Type</label>
                    <select id="sectionType">
                        <option value="protocol">Protocol (Blue)</option>
                        <option value="info">Information (Purple)</option>
                        <option value="warning">Warning (Orange)</option>
                        <option value="success">Success (Green)</option>
                        <option value="danger">Danger (Red)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="sectionContent">Content</label>
                    <textarea id="sectionContent" placeholder="Section content" rows="4"></textarea>
                </div>
                <div class="form-group">
                    <label for="sectionItems">List Items (one per line, optional)</label>
                    <textarea id="sectionItems" placeholder="• Item 1&#10;• Item 2&#10;• Item 3" rows="4"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button id="saveGuideSection" class="btn primary">Save Section</button>
                <button id="deleteGuideSection" class="btn danger">Delete Section</button>
                <button id="cancelGuideSection" class="btn secondary">Cancel</button>
            </div>
        </div>
    </div>

    <script src="api-client.js"></script>
    <script src="builder.js"></script>
    <script src="pathway-manager.js"></script>
    <script src="renderer.js"></script>
</body>
</html>